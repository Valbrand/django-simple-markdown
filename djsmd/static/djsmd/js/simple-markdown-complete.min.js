function getInputSelection(a){var b={start:0,end:0};a.focus();if("number"===typeof a.selectionStart&&"number"===typeof a.selectionEnd)b.start=a.selectionStart,b.end=a.selectionEnd;else return console.log("Your browser does not currently support 'selectionStart' functionality."),!1;return b}
function replaceSelectedText(a){"undefined"===typeof a.select&&(a.select=getInputSelection(a.element));"undefined"===typeof a.replacement&&(a.replacement="");var b=a.element.value.substring(0,a.select.start),c=a.element.value.substring(a.select.end,a.element.value.length);a.element.value=b+a.replacement+c;a.element.selectionStart=a.element.selectionEnd=b.length+a.replacement.length}
function surroundSelectionWith(a){"undefined"===typeof a.select&&(a.select=getInputSelection(a.element));"undefined"===typeof a.suffix&&(a.suffix=a.prefix);var b=String(a.prefix),c=String(a.suffix),d=a.element.value.substring(a.select.start,a.select.end);"undefined"!==typeof a.removeLineBreaks&&a.removeLineBreaks&&(d=d.replace(/\n/g,""));a.select&&(a.element.value=a.element.value.substring(0,a.select.start)+b+d+c+a.element.value.substring(a.select.end,a.element.value.length),a.element.selectionStart=
a.select.start==a.select.end?a.element.selectionEnd=a.select.start+b.length:a.element.selectionEnd=a.select.end+b.length+c.length)}function prependLineWith(a,b,c){"undefined"===typeof c&&(c=getInputSelection(a));var d=a.value.substring(0,c.start),e=a.value.substring(c.start,a.value.length),f=d.lastIndexOf("\n"),e=e.indexOf("\n");c.start=0<=f?f+1:0;c.end=0<=e?d.length+e:a.value.length;surroundSelectionWith({element:a,prefix:b,select:c,suffix:""})}
function prependMultipleLinesWith(a,b,c){"undefined"===typeof c&&(c=getInputSelection(a));for(var d=a.value.substring(0,c.start).lastIndexOf("\n")+1,e=!0,f=a.value.indexOf("\n",d);e;)surroundSelectionWith({element:a,prefix:b,select:{start:d,end:0>f?a.value.length:f},suffix:""}),0>f||f>c.end?e=!1:(d=a.selectionStart+1,f=a.value.indexOf("\n",d))};var wndw=null;function strengthenSelection(a){surroundSelectionWith({element:a,prefix:"**"})}function emphasizeSelection(a){surroundSelectionWith({element:a,prefix:"*"})}function makeTitle(a,b){var c=getInputSelection(a);c&&(c.start==c.end?prependLineWith(a,b,c):makeTitleFromSelection(a,b,c))}function makeTitleFromSelection(a,b,c){surroundSelectionWith({element:a,prefix:"\n"+headerString,select:c,suffix:"\n",removeLineBreaks:!0})}
function makeQuoteBlock(a){var b=getInputSelection(a);b&&(b.start==b.end?prependLineWith(a,"> ",b):prependMultipleLinesWith(a,"> ",b))}
function showHelpText(){text="Browser support:\nThis markdown editor is only supported by browsers that also support the selectionStart and selectionEnd properties of inputs and textareas. If your browser doesn't, and you want to use the widget's buttons to add formatting, please update your browser. You can of course format your text manually, the result will be the same.\n\nAbout line breaks:\nYou can insert line breaks in the resulting text by adding 2 whitespaces before a line break in your markdown text. This will result in a <br> tag.\nNew paragraphs can be creating by inserting two consecutives line breaks in your markdown text, which will cause the closure of the current <p> tag, and the opening of another one.\n\nFor more info (and for an explanation for the rest of Markdown's features), visit \nhttp://daringfireball.net/projects/markdown/syntax\n\nYou can also click 'OK' to open the Markdown Syntax Documentation in another tab/window.";window.confirm(text)&&
(null===wndw||wndw.closed?wndw=window.open("http://daringfireball.net/projects/markdown/syntax","MarkdownSyntaxDocs"):wndw.focus())}function makeHorizontalRule(a){var b=getInputSelection(a);b&&surroundSelectionWith({element:a,select:{start:b.start,end:b.start},prefix:"\n***",suffix:"\n"})}
function makeLink(a){var b=getInputSelection(a),c,d;b&&(selectedText=a.value.substring(b.start,b.end),textMask=window.prompt("'Link mask' (the text that will be used as an hyperlink, leave empty if you don't need it):",selectedText),c=window.prompt("Hyperlink url:","http://"),null!==c&&(null!==textMask?(d=window.prompt("Link title (optional, just press 'Cancel' if you don't want any):",""),c="["+textMask+"]("+c,null!==d&&""!==d&&(c+=' "'+d+'"'),c+=")"):c="<"+c+">",replaceSelectedText({element:a,select:b,
replacement:c})))}
function makeImage(a){var b=getInputSelection(a);b&&(selectedText=a.value.substring(b.start,b.end),textMask=window.prompt("Alternative text:",selectedText),url=window.prompt("Url for the image:","http://"),null!==url&&(null!==textMask?(title=window.prompt("Image title (optional, just press 'Cancel' if you don't want any):",""),result="!["+textMask+"]("+url,null!==title&&(result+=' "'+title+'"'),result+=")"):result="<"+url+">",replaceSelectedText({element:a,select:b,replacement:result})))}
function createMDEditor(a){"undefined"===typeof a&&(a={});"undefined"===typeof a.input_name&&(a.input_name="text");"undefined"===typeof a.default_style&&(a.default_style=!0);var b,c="h1 h2 h3 h4 h5 h6 quote hr bold italic link img help".split(" "),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("textarea");if("undefined"!==typeof a.parent_id)b=document.getElementById(a.parent_id),b.appendChild(d);else if("currentScript"in document)b=document.currentScript,
b.parentNode.insertBefore(d,b);else{console.log("(Simple-markdown.js) Error: 'parent_id' argument was not specified, and your browser does not support the use of the 'currentScript' property");return}e.className="md-editor-buttons";for(var g=0;g<c.length;g++)b=document.createElement("button"),b.setAttribute("type","button"),b.setAttribute("data-md-function",c[g]),b.className="md-editor-button",b.innerHTML=c[g],e.appendChild(b);d.className="md-editor";"undefined"!==typeof a.editor_id&&(d.id=a.editor_id);
d.appendChild(e);f.setAttribute("name",a.input_name);f.className="md-editor-textarea";d.appendChild(f);void 0!==window.attachEvent?window.attachEvent("onload",SMDSetupButtons):void 0!==window.addEventListener&&window.addEventListener("load",SMDSetupButtons,!1);a.default_style&&(d.style.display="table",d.style.padding="10px",d.style.backgroundColor="#ccc",d.style.border="1px solid #aaa",f.style.width="100%","boxSizing"in d.style?(d.style.boxSizing="border-box",f.style.boxSizing="border-box"):"MozBoxSizing"in
d.style&&(d.style.MozBoxSizing="border-box",f.style.MozBoxSizing="border-box"))}function SMDSetupSingleButton(a,b){void 0!==a.attachEvent?a.attachEvent("onclick",b):void 0!==a.addEventListener&&a.addEventListener("click",b,!1)}
function SMDSetupButtons(){for(var a,b,c={bold:function(a){return function(){strengthenSelection(a)}},italic:function(a){return function(){emphasizeSelection(a)}},h1:function(a){return function(){makeTitle(a,"# ")}},h2:function(a){return function(){makeTitle(a,"## ")}},h3:function(a){return function(){makeTitle(a,"### ")}},h4:function(a){return function(){makeTitle(a,"#### ")}},h5:function(a){return function(){makeTitle(a,"##### ")}},h6:function(a){return function(){makeTitle(a,"###### ")}},quote:function(a){return function(){makeQuoteBlock(a)}},
help:function(){return showHelpText},hr:function(a){return function(){makeHorizontalRule(a)}},link:function(a){return function(){makeLink(a)}},img:function(a){return function(){makeImage(a)}}},d=document.querySelectorAll(".md-editor-button"),e=0;e<d.length;e++)b=c[d[e].getAttribute("data-md-function")],a=d[e].parentNode.parentNode.getElementsByTagName("textarea")[0],SMDSetupSingleButton(d[e],b(a))};
